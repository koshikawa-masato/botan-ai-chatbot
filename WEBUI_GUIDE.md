# 牡丹 WebUI 利用ガイド

## 🌐 WebUIへのアクセス

### 基本URL
```
http://localhost:8000
```

自動的にチャット画面 (`/static/index.html`) にリダイレクトされます。

---

## 🎨 WebUIの機能

### チャット機能
- **リアルタイム対話**: WebSocketによる即座の応答
- **メッセージ履歴**: 会話の自動保存・表示
- **タイピングインジケータ**: 牡丹が考えている時の表示

### 音声機能
- **🔊 音声合成**: チェックボックスでON/OFF切り替え
- **音声再生**: メッセージごとに再生ボタン表示
- **自動キャッシュ**: 同じメッセージは再利用

### 高度な機能
- **🧠 反射推論**: チェックボックスでON/OFF切り替え
- **複数接続**: 複数のブラウザタブで同時チャット可能
- **自動再接続**: 接続が切れても自動で再接続

---

## 📱 画面の説明

### ヘッダー部分
```
🌸 牡丹チャット
17歳JKギャルAI Vtuber
```

### ステータス表示
- **🟢 接続済み**: WebSocket接続が正常
- **🔴 切断中...**: 接続が切断されている

### チャットエリア
- **左側（🌸）**: 牡丹のメッセージ
- **右側（👤）**: あなたのメッセージ
- **タイムスタンプ**: 各メッセージの送信時刻

### 入力エリア
- **テキスト入力欄**: メッセージを入力
- **送信ボタン**: クリックまたはEnterキーで送信

---

## 💡 使い方

### 基本的なチャット

1. ブラウザで `http://localhost:8000` を開く
2. テキスト入力欄にメッセージを入力
3. 送信ボタンをクリック（またはEnterキー）
4. 牡丹からの返信を待つ

**例:**
```
あなた: やっほー！
牡丹: ヤバい！久しぶりじゃん！何してたの？
```

### 音声合成を使う

1. 「🔊 音声合成」チェックボックスをON
2. メッセージを送信
3. 牡丹の返信に「▶️ 音声再生」ボタンが表示される
4. ボタンをクリックして音声を再生

**注意:**
- 音声生成には5-10秒かかります
- 初回はブラウザが音声再生を許可するか確認します

### 反射推論システムを使う

1. 「🧠 反射推論」チェックボックスをON
2. メッセージを送信
3. 牡丹がより深く考えて応答します

**効果:**
- ユーザーの意図を分析
- より適切な応答戦略を選択
- 応答品質が向上（処理時間は少し長くなります）

---

## 🎤 会話例

### 例1: カジュアルな挨拶
```
あなた: おはよう！
牡丹: おはよ〜！オジサン！今日もめっちゃ元気じゃん！

あなた: 今日はいい天気だね
牡丹: マジで！めっちゃ晴れてる！散歩したくなるよね〜
```

### 例2: 質問してみる
```
あなた: 牡丹って何歳？
牡丹: 17歳の高校生だよ！JKギャルだから〜

あなた: 好きなことは？
牡丹: えー、友達とカフェ行ったり、音楽聴いたりするの好き！
```

### 例3: 音声合成付き
```
あなた: 歌って！
牡丹: えー！恥ずかしいんだけど〜
      でもリクエストなら...
🔊 [▶️ 音声再生] ボタンが表示される
```

---

## 🔧 トラブルシューティング

### 「切断中...」と表示される

**原因:**
- Dockerサービスが停止している
- WebSocket接続に失敗している

**解決方法:**
```bash
# サービス状態を確認
docker compose ps

# 再起動
docker compose restart api
```

### 音声が再生されない

**原因:**
- ブラウザが音声再生をブロックしている
- ElevenLabs APIキーが設定されていない

**解決方法:**
1. ブラウザの音声再生許可を確認
2. `.env`ファイルでAPIキーを確認
3. 手動で「▶️ 音声再生」ボタンをクリック

### メッセージが送れない

**原因:**
- 接続が切断されている
- 入力欄が空

**解決方法:**
1. ステータスが「🟢 接続済み」か確認
2. ページをリロード
3. Dockerサービスを確認

---

## 🌍 外部からのアクセス

### 同じネットワーク内のデバイスから

WSL2のIPアドレスを使用:

```bash
# WSL2のIPアドレスを確認
ip addr show eth0 | grep "inet "
```

例: `http://172.x.x.x:8000`

### セキュリティ注意事項

⚠️ **現在の設定は開発用です**

- CORS: すべてのオリジンを許可
- 認証: なし
- HTTPS: なし

**本番環境では:**
- CORS設定を制限
- ユーザー認証を実装
- SSL/TLS証明書を設定
- ファイアウォール設定

---

## 📊 パフォーマンス

### 応答時間の目安

| 機能 | 処理時間 |
|------|---------|
| テキストチャット | 3-10秒 |
| 音声合成付き | 10-30秒 |
| 反射推論あり | 5-15秒 |
| 音声合成+反射推論 | 15-40秒 |

### 複数接続

- 同時接続数: 制限なし（メモリ依存）
- 推奨: 10クライアントまで
- テスト済み: 3クライアント同時

---

## 🎨 カスタマイズ

### デザインの変更

WebUIのデザインを変更したい場合:

```bash
# HTMLを編集
vi /home/koshikawa/aite/20251006/static/index.html

# JavaScriptを編集
vi /home/koshikawa/aite/20251006/static/chat.js

# 変更を反映
docker compose restart api
```

### 牡丹のキャラクター設定

キャラクター設定を変更するには:

```bash
# セットアップスクリプトを再実行
cd /home/koshikawa/aite/20251006/scripts
python3 setup_botan.py

# Dockerを再起動
docker compose restart core
```

---

## 📝 技術仕様

### 使用技術
- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla)
- **通信**: WebSocket (リアルタイム双方向)
- **音声**: HTML5 Audio API
- **スタイル**: グラデーション、アニメーション

### ブラウザ対応
- ✅ Chrome/Edge (推奨)
- ✅ Firefox
- ✅ Safari
- ⚠️ IE: 非対応

### レスポンシブ対応
- デスクトップ: 最適化済み
- タブレット: 対応
- スマートフォン: 対応

---

## 🚀 次のステップ

### WebUIの拡張機能（今後実装予定）

- [ ] ユーザー認証
- [ ] 会話履歴の保存・読み込み
- [ ] テーマ切り替え（ダーク/ライトモード）
- [ ] 音声入力（Whisper統合）
- [ ] 絵文字・スタンプ送信
- [ ] ファイル送信機能
- [ ] マルチモーダル対応（画像・動画）

### OBS連携（Phase 2.1）

- [ ] OBS Browser Source対応
- [ ] 透過背景
- [ ] 字幕表示
- [ ] アニメーション効果

---

**作成日**: 2025-10-06
**バージョン**: 2.0.0
