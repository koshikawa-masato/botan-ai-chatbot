# 📊 他己評価システム - ユーザーリアクション分析

## 🎯 コンセプト

**「牡丹の応答は、あなたの次の反応で評価される」**

従来のAI評価（自己評価）だけでなく、**ユーザーのリアクション**から牡丹の応答品質を判定する「他己評価」システムです。

---

## 🧠 評価の仕組み

### 自己評価（AI評価）
- 牡丹の応答をAIが1-5点で評価
- カテゴリ別の基準で採点
- リアルタイムで表示

### 他己評価（ユーザーリアクション評価）
- **ユーザーの次の発言**から牡丹の応答品質を推測
- -2.0 ~ +2.0 のスコア
- 会話のキャッチボール性を評価

### 総合評価
- 自己評価 + 他己評価の調整 = 総合スコア（1-5点）
- 両方の視点を統合した最終評価

---

## 📈 他己評価の判定基準

### ✅ ポジティブリアクション（+スコア）

| リアクション | 判定条件 | スコア | 意味 |
|------------|---------|--------|------|
| **話題の深掘り** | 「それで」「どうして」「詳しく」 | +1.5 | 会話が続いている |
| **笑い** | 「笑」「w」「面白い」 | +1.5 | 良い反応 |
| **共感・同意** | 「わかる」「そうだよね」「マジで」 | +1.0 | ユーザーが共感している |
| **良いキャッチボール** | 牡丹が適度（30-70文字）→ ユーザーが続ける | +0.5 | 会話のリズムが良い |

### ❌ ネガティブリアクション（-スコア）

| リアクション | 判定条件 | スコア | 意味 |
|------------|---------|--------|------|
| **同じ質問繰り返し** | 前回と同じ質問 | -2.0 | 牡丹が答えていない |
| **自分語りしすぎ** | 牡丹が長文（100文字超）→ ユーザー短文 | -1.5 | キャッチボールできてない |
| **短い返事** | 「うん」「へー」「...」のみ | -1.5 | 無関心 |
| **話題転換** | 全く関係ない新しい話題 | -1.0 | 牡丹の応答に興味がない |

---

## 💡 使用例

### ケース1: 非常にポジティブ（+2.0）

```
あなた: プログラミングって何？
牡丹: えー、プログラミングってなにそれ〜？ぼたん全然わかんない！
   💬 自己評価: ⭐⭐⭐⭐⭐ (5/5)

あなた: 笑 それでどうやって勉強するの？
   😊 前の応答への反応: 非常にポジティブ (+2.0) → 総合: 5.00/5.0
牡丹: ...
```

**理由:**
- ✅ ユーザーが笑っている（+1.5）
- ✅ 話題を深掘りしている（+1.5）
- ✅ 会話が自然に発展している（+0.5）

---

### ケース2: ネガティブ（-1.5）

```
あなた: 最近どう？
牡丹: あのね、ぼたんってね、マジで学校が好きでね、友達もいっぱいいてね、毎日楽しくてね、授業も面白いしね、放課後も遊んでてね、最高なんだよね〜！あとね、最近ハマってることがあってね、それは...
   💬 自己評価: ⭐⭐⭐⭐ (4/5)

あなた: へー
   😕 前の応答への反応: ネガティブ (-1.5) → 総合: 3.25/5.0
牡丹: ...
```

**理由:**
- ❌ 牡丹が自分語りしすぎ（100文字超）→ ユーザーが短文（-1.5）

---

## 🚀 使い方

### 基本的な使い方

```bash
python3 chat_with_learning.py
```

会話を進めると、自動的に：
1. **牡丹の応答が表示される**
2. **AI自己評価が表示される**
3. **次の入力時、前の応答への他己評価が表示される**

### コマンド

- `score` - 現在のセッション統計を表示（自己評価・総合評価の両方）
- `exit` / `quit` - 終了して保存

---

## 📊 保存データの構造

```json
{
  "conversations": [
    {
      "user": "おはよう",
      "botan": "おはよー！マジで元気じゃん！",
      "evaluation": {
        "score": 5,
        "category": "ギャル語",
        "reasons": [...]
      },
      "reaction_evaluation": {
        "reaction_score": 1.5,
        "reaction_type": "ポジティブ",
        "reasons": ["✅ ユーザーが話題を深掘りしている"],
        "combined_score": 5.0
      }
    }
  ],
  "statistics": {
    "average_score": 4.5,
    "average_combined_score": 4.7,
    "turns_with_reaction": 9,
    "total_turns": 10
  }
}
```

---

## 🌱 学習への活用

### 高品質会話の条件

従来（自己評価のみ）:
- 自己評価が4-5点

**新しい基準（総合評価）**:
- 総合評価が4.0以上
- ユーザーリアクションがポジティブ（+0.5以上）

### 改善が必要な応答

- 総合評価が3.0未満
- 自己評価は高いが、他己評価が低い（-1.0以下）
  → 牡丹の応答スタイルに問題がある可能性

---

## 💡 活用のヒント

### 会話のコツ

**DO ✅**
- 自然に会話を続ける
- 笑えたら素直に「笑」と反応
- 興味があれば深掘りする
- 共感できたら「わかる」と伝える

**DON'T ❌**
- 無理にポジティブリアクションしない
- 興味がないのに続けない
- 評価のために不自然な会話をしない

### 分析のポイント

- **自己評価は高いが総合評価が低い** → 牡丹の応答スタイルを見直す
- **他己評価が常にネガティブ** → ユーザーとの相性？話題選び？
- **キャッチボール性が低い** → 応答の長さを調整

---

## 🔧 カスタマイズ

### 他己評価ロジックの調整

`user_reaction_analyzer.py` を編集：

```python
# ポジティブパターンを追加
deepening_patterns = ["それで", "どうして", "詳しく", "もっと"]

# ネガティブパターンを追加
short_responses = ["うん", "そう", "はい", "..."]

# スコア調整
reaction_score += 1.5  # 深掘りの重み
```

---

## 📚 関連ファイル

- `user_reaction_analyzer.py` - 他己評価ロジック
- `chat_with_learning.py` - 学習型チャット（自己評価+他己評価）
- `analyze_learning.py` - データ分析（総合評価対応予定）
- `growth_dashboard.py` - 成長可視化（総合評価対応予定）

---

**作成日**: 2025-10-06
**バージョン**: 1.0 (他己評価システム実装)
